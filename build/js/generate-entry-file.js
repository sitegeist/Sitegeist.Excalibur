const fs = require('fs-extra');

const template = components => `
//
// This is an autogenerated File
//
const components = [
${components.map(component => `
	{
		identifier: '${component.identifier}',
		initialize: require('${component.path}')
	},
`)}
];

const bootstrap = () => {
	components.forEach(({identifier, initialize}) => {
		[].slice.call(document.querySelectorAll('[data-component="' + identifier + '"]'))
			.forEach(el => initialize.default ? initialize.default(el) : initialize(el));
	})
};

document.addEventListener('DOMContentLoaded', bootstrap);
document.addEventListener('Neos.PageLoaded', bootstrap);
`;

module.exports = (filePath, components) => {
	fs.ensureFileSync(filePath);
	fs.writeFileSync(filePath, template(components.map(
		component => ({
			identifier: component.split('Resources/Private/Fusion/')[1]
				.split('/Component.js')[0]
				.split('/component.js')[0]
				.split('/Index.js')[0]
				.split('/index.js')[0],
			path: component
		})
	)));
};
